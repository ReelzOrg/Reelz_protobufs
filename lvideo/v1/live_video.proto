syntax = "proto3";

package lvideo.v1; // Must match directory structure lvideo/v1/

option go_package = "lvideo/v1;lvideov1";

import "buf/validate/validate.proto";

message BroadcastConfig {
	bool enableHls = 1;
	bool enableRecording = 2;
}

message AuthProperties {
	string secretToken = 1;
}

message CreateRoomRequest {
	// This validation is not actually required because the grpc will be sent from another service
	string streamId = 1 [(buf.validate.field).string.uuid = true];
	string broadcasterId = 2 [(buf.validate.field).string.uuid = true];

	// Ensures the 'config' object is actually sent in the request since messages are optional in proto3
	BroadcastConfig config = 3 [(buf.validate.field).required = true];
	AuthProperties auth = 4 [(buf.validate.field).required = true];

	// Custom rule: `streamId` and `broadcasterId` can't be the same.
  option (buf.validate.message).cel = {
    id: "streamId.not.broadcasterId"
    message: "streamId and broadcasterId should not be the same"
    expression: "this.streamId != this.broadcasterId"
  };
}

message CreateRoomResponse {
	bool success = 1;
	string message = 2;
}

service LiveVideo {
	rpc CreateRoom (CreateRoomRequest) returns (CreateRoomResponse) {}
}